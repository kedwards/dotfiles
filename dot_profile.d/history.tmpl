{{- $shell := env "SHELL" | base -}}

# History configuration for {{ $shell }}

# Common history settings (shell-agnostic)
export HISTSIZE=500000
export HISTFILESIZE=100000

{{- if eq $shell "bash" }}
# === BASH CONFIGURATION ===

# Enable autocd (implicit `cd` when typing a directory)
shopt -s autocd 2>/dev/null

# Enable recursive globbing (** to match subdirectories)
shopt -s globstar 2>/dev/null

# Enable multi-line commands in history
shopt -s cmdhist

# Append to history file instead of overwriting
shopt -s histappend

# Prevent duplicate lines and lines starting with space from being recorded in history
export HISTCONTROL="erasedups:ignoreboth"
export HISTIGNORE="&:[ ]*:exit:ls:bg:fg:history"

# Set history timestamp format
export HISTTIMEFORMAT='%F %T '

# Automatically trim long paths in the prompt (only works in Bash 4.x+)
PROMPT_DIRTRIM=2

{{- else if eq $shell "zsh" }}
# === ZSH CONFIGURATION ===

# Enable autocd and extended globbing
setopt autocd extendedglob

# Enable recursive globbing
setopt GLOBSTARSHORT

# History settings
setopt HIST_IGNORE_SPACE      # Ignore commands that start with a space
setopt HIST_IGNORE_DUPS       # Ignore duplicates
setopt HIST_SAVE_NO_DUPS      # Do not save duplicates
setopt HIST_FIND_NO_DUPS      # Prevent duplicate matches in history search
setopt INC_APPEND_HISTORY     # Append commands as they are executed
setopt HIST_EXPIRE_DUPS_FIRST # Remove oldest duplicate when history is full
setopt APPEND_HISTORY         # Append to history file instead of overwriting
setopt INC_APPEND_HISTORY     # Write history incrementally
setopt SHARE_HISTORY          # Share history between sessions

# Completion case-insensitive matching
zstyle ':completion:*' matcher-list 'm:{a-zA-Z}={A-Za-z}'

# Set history timestamp format
export HIST_STAMPS="yyyy-mm-dd"

# Prompt configuration
setopt PROMPT_SUBST # Allow prompt modifications
PROMPT='%~%# '      # Shorten path in prompt (~ replaces $HOME)

{{- end }}
