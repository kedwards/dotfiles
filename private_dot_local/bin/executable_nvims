#!/bin/bash

config=""
history="${XDG_CACHE_HOME:-$HOME/.cache}/nvim-configuration"

trap 'echo "$config" >"$history"' EXIT

items=$(find -L "$HOME/.config" -maxdepth 2 -name "init.lua" -type f -execdir sh -c 'pwd | xargs basename' \;)

case $1 in
-C | --config)
  if [ -z "$2" ]; then
    if command -v fzf &> /dev/null; then
      config=$(echo "$items" | tr ' ' '\n' | fzf --prompt=" Neovim Config  " --height=~50% --layout=reverse --border --exit-0) || exit 0
    else
      select c in "$items"; do
        config="$c"
        break
      done
    fi
    shift
  else
    config="$2"
    shift
    shift
  fi
  ;;
*)
  config=$(cat "$history")
  ;;
esac

[ "$config" = "default" ] && config=""

NVIM_APPNAME="${config:-""}" nvim "$@"
