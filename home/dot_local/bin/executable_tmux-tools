#!/usr/bin/env bash
set -euo pipefail

attach() {
  [[ -n "$TMUX" ]] && return 0

  local s
  s="$(tmux ls -F '#{session_last_attached} #{session_id}' 2>/dev/null | sort -nr | awk 'NR==1 {print $2}')"

  if [[ -n "$s" ]]; then
    tmux attach -t "$s"
  else
    tmux
  fi
}

case "${1:-}" in
  attach|"") attach ;;
esac
